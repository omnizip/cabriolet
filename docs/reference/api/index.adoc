---
title: API Reference
parent: Reference
has_children: true
nav_order: 2
---

== Ruby API reference

=== Purpose

Complete reference for the Cabriolet Ruby API. Use this section to integrate Cabriolet into your Ruby applications with detailed class and method documentation.

=== References

* <<../../getting-started/index,Getting Started Guide>>
* <<../cli/index,CLI Reference>>
* <<../../guides/advanced-usage/memory-operations,Memory Operations>>

=== Concepts

Cabriolet's Ruby API follows object-oriented design principles with a consistent interface across all formats. Each format provides Decompressor and Compressor classes, along with model classes representing the archive structure.

=== API Organization

==== Format APIs

Complete API for each format:

* link:cab-api[`Cabriolet::CAB` module]
* link:chm-api[`Cabriolet::CHM` module]
* link:szdd-api[`Cabriolet::SZDD` module]
* link:kwaj-api[`Cabriolet::KWAJ` module]
* link:hlp-api[`Cabriolet::HLP` module]
* link:lit-api[`Cabriolet::LIT` module]
* link:oab-api[`Cabriolet::OAB` module]

==== Core Components

Shared components used across formats:

* link:models[Cabinet, Folder, File, Header classes]
* link:system-io[IOSystem, FileHandle, MemoryHandle]
* link:error-classes[Exception hierarchy]

=== Quick API reference

==== CAB Format

[source,ruby]
----
require 'cabriolet'

# Decompress
decompressor = Cabriolet::CAB::Decompressor.new('archive.cab')
decompressor.extract('output/')

# Compress
compressor = Cabriolet::CAB::Compressor.new(compression: :mszip)
compressor.add_file('file.txt')
compressor.write('new.cab')
----

==== CHM Format

[source,ruby]
----
require 'cabriolet'

# Decompress
decompressor = Cabriolet::CHM::Decompressor.new('help.chm')
decompressor.extract('output/')
----

==== SZDD Format

[source,ruby]
----
require 'cabriolet'

# Decompress
decompressor = Cabriolet::SZDD::Decompressor.new('notepad.ex_')
decompressor.extract('notepad.exe')

# Compress
compressor = Cabriolet::SZDD::Compressor.new
compressor.compress('notepad.exe', 'notepad.ex_')
----

=== Module Hierarchy

[source,text]
----
Cabriolet
├── CAB
│   ├── Decompressor
│   ├── Compressor
│   ├── Parser
│   └── Extractor
├── CHM
│   ├── Decompressor
│   ├── Compressor
│   └── Parser
├── SZDD
│   ├── Decompressor
│   ├── Compressor
│   └── Parser
├── KWAJ
│   ├── Decompressor
│   ├── Compressor
│   └── Parser
├── HLP
│   ├── Decompressor
│   ├── Compressor
│   └── Parser
├── LIT
│   ├── Decompressor
│   └── Compressor
├── OAB
│   ├── Decompressor
│   └── Compressor
├── Models
│   ├── Cabinet
│   ├── Folder
│   ├── File
│   ├── ChmHeader
│   ├── SzddHeader
│   ├── KwajHeader
│   ├── HlpHeader
│   └── LitHeader
├── System
│   ├── IOSystem
│   ├── FileHandle
│   └── MemoryHandle
├── Decompressors
│   ├── None
│   ├── LZSS
│   ├── MSZIP
│   ├── LZX
│   └── Quantum
└── Errors
    ├── Error
    ├── FormatError
    ├── CorruptionError
    ├── UnsupportedError
    └── IOError
----

=== Common patterns

==== Opening archives

All decompressors follow the same pattern:

[source,ruby]
----
# From file path
decompressor = Cabriolet::CAB::Decompressor.new('archive.cab')

# From file handle
File.open('archive.cab', 'rb') do |f|
  decompressor = Cabriolet::CAB::Decompressor.new(f)
end

# From IO object
io = StringIO.new(cab_data)
decompressor = Cabriolet::CAB::Decompressor.new(io)
----

==== Extracting files

[source,ruby]
----
# Extract all to directory
decompressor.extract('output/')

# Extract single file
decompressor.extract_file('readme.txt', 'output/readme.txt')

# Extract to memory
data = decompressor.extract_to_memory('file.dat')

# Iterate files
decompressor.each_file do |file|
  puts "#{file.name}: #{file.size} bytes"
end
----

==== Creating archives

[source,ruby]
----
# Create new archive
compressor = Cabriolet::CAB::Compressor.new

# Add files
compressor.add_file('readme.txt')
compressor.add_file('data.bin')

# Write to disk
compressor.write('archive.cab')

# Write to IO
output = StringIO.new
compressor.write(output)
cab_data = output.string
----

==== Error handling

[source,ruby]
----
require 'cabriolet'

begin
  decompressor = Cabriolet::CAB::Decompressor.new('archive.cab')
  decompressor.extract('output/')
rescue Cabriolet::FormatError => e
  puts "Invalid format: #{e.message}"
rescue Cabriolet::CorruptionError => e
  puts "Corrupted archive: #{e.message}"
rescue Cabriolet::IOError => e
  puts "I/O error: #{e.message}"
rescue Cabriolet::Error => e
  puts "Error: #{e.message}"
end
----

=== Thread Safety

Cabriolet classes are thread-safe for read operations:

* **Decompressors**: Safe to use from multiple threads
* **Compressors**: Not thread-safe, use one per thread
* **Models**: Immutable after creation, safe to share

=== Performance considerations

==== Memory usage

[source,ruby]
----
# Low memory: Stream files one at a time
decompressor.each_file do |file|
  file.extract_to("output/#{file.name}")
end

# Higher memory: Load entire archive
cabinet = decompressor.cabinet
cabinet.files.each do |file|
  # Process files
end
----

==== I/O efficiency

[source,ruby]
----
# Efficient: Batch operations
compressor = Cabriolet::CAB::Compressor.new
Dir.glob('files/**/*').each do |path|
  compressor.add_file(path) if File.file?(path)
end
compressor.write('archive.cab')

# Inefficient: Multiple writes
Dir.glob('files/**/*').each do |path|
  compressor = Cabriolet::CAB::Compressor.new
  compressor.add_file(path)
  compressor.write("#{File.basename(path)}.cab")
end
----

=== API Conventions

==== Naming

* **Classes**: CamelCase (e.g., `Decompressor`)
* **Methods**: snake_case (e.g., `extract_file`)
* **Constants**: SCREAMING_SNAKE_CASE (e.g., `COMPRESSION_NONE`)

==== Parameters

* **Required first**: `method(required, optional = default)`
* **Options hash last**: `method(param, options = {})`
* **Blocks accepted**: Many methods accept blocks for iteration

==== Return values

* **Self for chaining**: Modification methods return `self`
* **Enumerators**: Iteration methods return enumerators if no block
* **Nil for side effects**: Write operations return `nil`

=== Next steps

* Choose your format and review its API documentation
* Study <<models,archive structure>>
* Learn about <<system-io,custom I/O backends>>
* Review <<error-classes,exception handling>>

=== Related sections

* link:../cli/[Command-line tools]
* link:../../guides/basic-usage/[Common operations]
* link:../../guides/advanced-usage/[Advanced features]
* link:../../concepts/[Core concepts and architecture]

=== Bibliography

* https://github.com/omnizip/cabriolet[Cabriolet Source Code]
* https://docs.microsoft.com/en-us/previous-versions/bb417343(v=msdn.10)[Microsoft Cabinet SDK]